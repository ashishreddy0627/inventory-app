-- Auto-create stock_transactions table on startup

CREATE TABLE IF NOT EXISTS stock_transactions (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    item_id BIGINT NOT NULL,
    store_id BIGINT NOT NULL,
    type VARCHAR(20) NOT NULL,
    quantity INTEGER NOT NULL,
    stock_before INTEGER NOT NULL,
    stock_after INTEGER NOT NULL,
    transaction_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    notes VARCHAR(500),
    user_id BIGINT,
    CONSTRAINT fk_stock_tx_item FOREIGN KEY (item_id) REFERENCES items(id),
    CONSTRAINT fk_stock_tx_store FOREIGN KEY (store_id) REFERENCES stores(id)
);

CREATE INDEX IF NOT EXISTS idx_stock_tx_item ON stock_transactions(item_id);
CREATE INDEX IF NOT EXISTS idx_stock_tx_store ON stock_transactions(store_id);
CREATE INDEX IF NOT EXISTS idx_stock_tx_date ON stock_transactions(transaction_date);